<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Car Reservation</title>
    <link rel="stylesheet" href="styless2.css">
</head>
<body>
    <form class="form" action="payment.html" method="get">
        <h1 class="title">Car Reservation</h1>

        <!-- Car Details Section -->
        <h2>Car Details</h2>
        <label>
            <input class="input" type="text" id="company" readonly>
            <span>Company</span>
        </label>
        <label>
            <input class="input" type="text" id="model" readonly>
            <span>Model</span>
        </label>
        <label>
            <input class="input" type="text" id="year" readonly>
            <span>Year</span>
        </label>
        <label>
            <input class="input" type="text" id="fuel_type" readonly>
            <span>Fuel Type</span>
        </label>
        <label>
            <input class="input" type="text" id="no_seats" readonly>
            <span>No. of Seats</span>
        </label>
        <label>
            <input class="input" type="text" id="price_per_day" readonly>
            <span>Price per Day</span>
        </label>
        <label>
            <input class="input" type="text" id="car_id" readonly>
            <span>Car ID</span>
        </label>

        <!-- Reservation Dates -->
        <h2>Reservation Details</h2>
        <label>
            <input class="input" type="date" name="pickup_date" placeholder=" " required>
            <span>Pickup Date</span>
        </label>
        <label>
            <input class="input" type="date" name="return_date" placeholder=" " required>
            <span>Return Date</span>
        </label>

        <button type="submit" class="submit">Proceed to Payment</button>
    </form>

    <script>
        // Function to get URL query parameters
        function getQueryParams() {
            const params = {};
            const queryString = window.location.search.substring(1);
            const queryArray = queryString.split("&");

            queryArray.forEach(query => {
                const [key, value] = query.split("=");
                params[decodeURIComponent(key)] = decodeURIComponent(value);
            });

            return params;
        }

        // Populate form fields with car data
        function populateCarDetails() {
            const params = getQueryParams();

            document.getElementById('company').value = params.company || '';
            document.getElementById('model').value = params.model || '';
            document.getElementById('year').value = params.year || '';
            document.getElementById('fuel_type').value = params.fuel_type || '';
            document.getElementById('no_seats').value = params.no_seats || '';
            document.getElementById('price_per_day').value = params.price_per_day || '';
            document.getElementById('car_id').value = params.car_id || '';
        }

        // Calculate total amount and redirect
        document.querySelector('.form').addEventListener('submit', (event) => {
            event.preventDefault();

            // Get input values
            const pricePerDay = parseFloat(document.getElementById('price_per_day').value) || 0;
            const pickupDate = new Date(document.querySelector('input[name="pickup_date"]').value);
            const returnDate = new Date(document.querySelector('input[name="return_date"]').value);

            // Calculate the number of days
            const timeDifference = returnDate - pickupDate;
            const numberOfDays = timeDifference > 0 ? timeDifference / (1000 * 60 * 60 * 24) : 0;

            // Calculate the total amount
            const totalAmount = (pricePerDay * numberOfDays).toFixed(2);

            // Add total amount to the URL as a query parameter
            const form = event.target;
            const action = new URL(form.action);
            action.searchParams.set('total_amount', totalAmount);

            // Append other existing query parameters
            const params = new URLSearchParams(new FormData(form));
            params.forEach((value, key) => {
                action.searchParams.set(key, value);
            });

            // Redirect to the modified URL
            window.location.href = action.toString();
        });

        // Populate the form when the page loads
        window.onload = populateCarDetails;
    </script>
</body>
</html>
